# ExecutionLens Logger Package Documentation

This package provides a logging mechanism for API execution, capturing requests, responses, and method calls in services for structured logging and easier debugging. It supports logging to both ElasticSearch and email notifications based on the severity level.

## Package Setup

### 1. Register the Logger

To configure and register the logger, use the following code in your `Program.cs` file:

```csharp
builder.Services.AddLogger(config =>
{
    config.ElasticUri = "http://localhost:9200";                // ElasticSearch instance URI
    config.Index = "demo";                                      // Index name for storing logs

    // Email notifications configuration
    config.EmailConfiguration = new()
    {
        Address = "nicolaev.andrei09@gmail.com",
        Password = "pwd",                                       // Password for the email account
        Client = "smtp.gmail.com",                              // Email client (e.g., SMTP server)
        Port = 587,                                             // Email server port
        To = new[] { "andrei.nicolaev@365.univ-ovidius.ro" }    // Recipients
    };
});
```

### 2. Register Services in the DI Container

You must register your services in the DI (Dependency Injection) container using either `AddLoggedScoped` or `AddLoggedTransient` depending on the service's lifecycle. The logger doesn't support singleton registration.

For example:

```csharp
builder.Services.AddLoggedScoped<IReservationService, ReservationService>();
```

or

```csharp
builder.Services.AddLoggedTransient<IReservationService, ReservationService>();
```

**Note:** Singleton registration is not supported by the logger.

### 3. Configure Logger Options

The `LoggerConfiguration` class provides several options for customizing the logger:

```csharp
public class LoggerConfiguration
{
    public string ElasticUri { get; set; } = string.Empty;                  // ElasticSearch URI
    public string Index { get; set; } = "logs";                             // Log index name
    public bool LogOnlyOnException { get; set; } = false;                   // Log only on exceptions
    public bool LogToConsole { get; set; } = false;                         // Enable console logging
    public LogLevel MinimumLogLevel { get; set; } = LogLevel.Information;   // Minimum log level
    public LogLevel MinimumEmailLevel { get; set; } = LogLevel.Error;       // Minimum email notification log level
    public EmailConfiguration? EmailConfiguration { get; set; } = null;     // Email settings
}
```

### 4. Use the `[Log]` Attribute

To enable logging on specific endpoints, simply add the [Log] attribute to the controller action or method that you wish to log. This will capture the request, response, and method calls for that action.

For example:

```csharp
[Log]
[HttpPost]
public IActionResult CreateReservation([FromBody] ReservationRequest request)
{
    // Your API logic
}
```

### 5. Debugging with Execution Logs

The logs generated by this package not only store the request and response but also each method call from the services registered with `AddLoggedScoped` or `AddLoggedTransient`. These detailed logs can be used to reproduce and trace API executions, providing a more efficient debugging experience.

## GitHub Repository for Reproducing Executions

For a package that can reproduce executions from logs for easier debugging, visit the following GitHub repository:

[ExecutionLens.Debugging GitHub Repository](https://github.com/Andrei1128/ExecutionLens.Debugging)
